# payCanvas テスト戦略

## 1. レイヤ別テスト方針
- **ユニットテスト**: ドメインロジック（歩合計算、給与集計など）が実装された際にJUnitでカバレッジを確保する。
- **リポジトリテスト**: JPAクエリの動作確認を含む場合、`@DataJpaTest` を用いて主要なRepositoryメソッドを検証する。
- **サービス統合テスト**: `@SpringBootTest` を使用し、MockMvcやTestRestTemplateでAPIエンドポイントをテストする。
- **E2E/UIテスト**: Playwrightを活用し、代表的なユーザーフロー（ログイン→日次実績→給与計算→給与明細）を自動化。

## 2. テスト対象と推奨ケース
- 認証API: 正常系（全ロール）、異常系（認証失敗、無効ユーザー）
- 機能フラグAPI: 更新時のパーミッション、反映結果
- 日次実績API: フィルター条件の検証、勤怠ステータス変更
- 給与計算API: ジョブ登録、重複実行、結果確認
- UI: ロール別メニュー表示、給与計算ウィザード、機能フラグ切替

## 3. 自動テストの整備状況
- Playwrightベースのスモークテストを `npm run test:ui` で実行可能
- バックエンドのユニットテストは未作成。今後、ドメインロジック実装後に追加予定

## 4. 実行コマンド例
```bash
# フロントエンドビルド
npm run build

# UIテスト（サーバー起動済みであること）
npx playwright install
npm run test:ui

# バックエンドビルド/テスト (Gradle Wrapper生成済みの場合)
cd src/backend
./gradlew build
./gradlew test
```

## 5. 今後の課題
- 給与計算ロジックが実装された段階でユニット/統合テストを整備
- API仕様確定後にOpenAPI/Contractテストを導入
- CI/CDパイプラインにUIテスト結果を組み込み
