# payCanvas 機能実装タスクリスト（詳細）

## 1. 認証・権限
- [x] JWT発行・リフレッシュトークン管理
  - [x] 登録済みユーザーに対してアクセストークン／リフレッシュトークンを発行
  - [x] トークン失効・更新、ブラックリスト（撤回）管理
- [ ] Spring Securityでのアクセス制御
  - [x] ロール別にAPIエンドポイントを保護
  - [ ] フロントエンドとの連携（401/403のハンドリング）
- [ ] アカウント管理
  - [ ] パスワードリセット（メール送信）
  - [ ] アカウントロック／ロック解除

## 2. マスタ管理
- [x] 従業員管理
  - [ ] CRUD画面とAPI（検索、フィルタ、バリデーション）
  - [ ] CSVインポート／エクスポート
- [x] 店舗・等級・給与プラン管理
  - [x] 各マスタのCRUD・関連付け
  - [ ] バージョン管理 or 変更履歴
- [ ] ユーザーアカウント管理
  - [ ] 管理画面でのユーザー登録／ロール付与
  - [ ] プロファイル編集

## 3. 日次実績
- [ ] 勤怠／売上データの扱い
  - [ ] APIでの一覧・フィルタ・編集
  - [ ] UI上での差分表示／レビュー状態
- [ ] 外部システム連携
  - [ ] KING OF TIME API、POSデータ取り込みバッチ
  - [ ] エラー通知／再実行フロー
- [ ] 差分管理
  - [ ] フィードバック指摘／承認フロー
  - [ ] 変更履歴の保管

## 4. 給与計算
- [ ] ロジック実装
  - [ ] 基本給・歩合・保証・手当・控除の計算
  - [ ] 休日出勤、残業などのルール対応
- [ ] バッチ処理
  - [ ] 非同期ジョブと進捗通知（WebSocket or ポーリング）
  - [ ] ジョブ履歴管理・再実行
- [ ] エクスポート
  - [ ] 弥生給与フォーマットのCSV作成
  - [ ] 仕訳データ等の出力

## 5. 賞与管理
- [ ] 算出ロジック
  - [ ] 半期ごとの売上・評価に基づく支給額計算
  - [ ] 保証・控除の考慮
- [ ] スケジュール管理
  - [ ] 支給時期（1月／7月等）の設定
  - [ ] 支給履歴・ステータス管理

## 6. レポート／ダッシュボード
- [ ] KPI集計
  - [ ] 人件費、売上、労働時間などリアルタイム集計
  - [ ] 指標の月次／年次比較
- [ ] 通知・アラート
  - [ ] 勤怠未入力、売上目標未達などの検知
  - [ ] メール／画面通知
- [ ] レポート出力
  - [ ] CSV／PDF形式の帳票
  - [ ] フィルタ保存・定期出力

## 7. 運用・監視
- [ ] 監査ログ
  - [ ] 認証／認可、重要操作（給与計算、マスタ更新）の記録
- [ ] モニタリング
  - [ ] APM（New Relic, Datadogなど）導入
  - [ ] メトリクス／ログ可視化
- [ ] 通知
  - [ ] エラー発生やジョブ失敗時のSlack／メール通知
